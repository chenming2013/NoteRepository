[参考]

> 1. https://www.icourse163.org/learn/NUDT-359002?tid=1002787006#/learn/content?type=detail&id=1003836848&cid=1004616604&replay=true
> 2. https://mooc.study.163.com/learn/1000002002?tid=2402970006&_trace_c_p_k2_=5217a7a2a6a74d53acf0953d2ed28ef9#/learn/content?type=detail&id=2403306501



# 1. 计算机系统概论

## 1.1 计算机系统简介

### 1.1.1 计算机的软硬件概念：

计算机的软件通常分为两大类：系统软件和应用软件

- 系统软件：系统软件又称为系统程序，主要用来管理整个计算机系统，监视服务，使系统资源得到合理调度，高效运行。它包括：标准程序库、语言处理程序、操作系统、服务程序、数据库管理系统、网络软件。
- 应用软件：应用软件又称为应用程序，它是用户根据任务需要所编制的各种程序，如科学计算程序、数据处理程序、过程控制程序、事务管理程序。

### 1.1.2 计算机的层次结构：

![image-20210407071711731](images/计算机组成原理详解/image-20210407071711731.png)

> 软硬件的交界面的划分并不是一成不变的，但一般来说，软硬件的交界面指的是指令系统。

>随着超大规模集成电路技术的不断发展，一部分软件功能将由硬件来实现，例如，目前操作系统已实现了部分固化（把软件永恒的存于只读存储器中），称为固件。

### 1.1.3 计算机组成和计算机体系结构：

#### 1.1.3.1 计算机体系结构：

> 计算机体系结构是指那些能够被程序员所见到的计算机系统的属性，即概念性的结构与功能特性。

计算机系统的属性通常是指用机器语言编程的程序员（也包括汇编语言程序设计者和汇编程序设计者）所看到的传统机器的属性，包括指令集、数据类型、存储器寻址技术、I/O机理等，大都属于抽象的属性。

#### 1.1.3.2 计算机组成：

> 计算机组成是指如何实现计算机体系结构所体现的属性，它包含了许多对程序员来说是透明的硬件细节。



## 1.2 计算机的基本组成

### 1.2.1 冯诺依曼计算机的特点：

1945年，数学家冯诺依曼在研究EDVAC机时提出了**“存储程序”**的概念，以此概念为基础的各类计算机统称为冯诺依曼机。它的特点可归结如下：

- 计算机由运算器、存储器、控制器、输入设备和输出设备五大部件组成；

- **指令和数据以`同等的地位`存放于存储器内**，并可按地址访问；

- 指令和数据均用二进制数表示；

- 指令由操作码和地址码组成，操作码用来表示操作的性质，地址码用来表示操作数在存储器中的位置；

- 指令在存储器内按顺序存放。通常，指令是顺序执行的，在特定的条件下，可根据运算结果或根据设定的条件改变执行顺序；

- 机器以运算器为中心，输入输出设备与存储器间的数据传送通过运算器完成。

  [注]`早期的计算机是以运算器为核心，但现代的计算机优化为以存储器为核心`。

### 1.2.2 计算机的硬件框图：

典型的冯诺依曼计算机是以运算器为中心的，如下图所示：

![image-20210412182021148](images/计算机组成原理详解/image-20210412182021148.png)

现代的计算机已转化为以存储器为中心，如下图：

![image-20210412182104854](images/计算机组成原理详解/image-20210412182104854.png)

图中各部件的功能如下：

- 运算器用来完成算术运算和逻辑运算，并将运算的中间结果暂存到运算器内；
- 存储器用来存放数据和程序；
- 控制器用来控制、指挥程序和数据的输入、运行以及处理运算结果；
- 输入设备用来将人们熟悉的信息形式转换为机器能识别的信息形式，常见的有键盘、鼠标等；
- 输出设备可将机器运算结果转换为人们熟悉的信息形式，如打印机输出、显示器输出等；

`计算机的五大部件（又称五大子系统）在控制器的统一指挥下，有条不紊的自动工作`。

由于运算器和控制器在逻辑关系和电路结构上关系十分紧密，尤其在大规模集成电路制作工艺出现以后，这两大部件往往集成在同一个芯片上，因此，通常将它们合起来统称为中央处理器（Central Processing Unit，CPU）。把输入设备与输出设备简称为I/O设备。

这样，现代计算机可认为由三大部件组成：CPU、I/O设备及主存储器（Main Memory，MM），如下图所示。CPU与主存储器合起来又可称为主机，I/O设备又可称为外部设备。

![image-20210412183239179](images/计算机组成原理详解/image-20210412183239179.png)

### 1.2.3 计算机的工作步骤：

#### 1.2.3.1 计算机的工作部件分析：

为了比较形象的了解计算机的工作过程，首先分析一下如下图的计算机组成框图：

![‘](images/计算机组成原理详解/image-20210412193121908.png)

​														图1.2.3.1

##### 1.2.3.1.1 主存储器：

主存储器（简称主存或内存）包括存储体M、各种逻辑部件及控制电路等。

存储体由许多存储单元组成，每个存储单元又包含若干个存储元件（或称存储基元、储存元），每个存储元件能寄存一位二进制代码“0”或“1”。可见，一个存储单元可存储一串二进制代码，称这串二进制代码为一个存储字，这串二进制代码的位数称为**存储字长**。存储字长可以是8位、16位或32位等。

一个存储字可代表一个二进制数，也可代表一串字符，如存储字为001101100111101，既可表示为由十六进制字符组成的367DH，又可代表16位的二进制数，此值对应十进制数为13949，还可以代表两个两个ASCII码：“6”和“}”。一个存储字还可以代表一条指令。

主存的工作方式就是按存储单元的地址号来实现对存储字各位的存（写入）、取（读出）。这种存取方式称为按地址读取方式，即按地址访问存储器（简称访存）。

为了能实现按地址访问的方式，主存中还必须配置两个寄存器MAR和MDR。MAR（Memory Address Registry）是存储器地址寄存器，用来存放欲访问的存储单元的地址，其位数对应存储单元的个数（如MAR为10位，则有2^10=1024个存储单元吗，记为1K）。MDR（Memory Data Registry）是存储器数据寄存器，用来存放从存储体某单元取出的代码或者准备往某存储单元存入的代码，其位数与存储字长相等。当然，要想完整的完成一个取或存操作，CPU还得给主存加以各种控制信号，如读命令、写命令和地址译码驱动信号等。`随着硬件技术的发展，主存都制成大规模集成电路的芯片，而将MAR和MDR集成在CPU芯片中`。

早期计算机的存储字长一般和机器的指令字长和数据字长相等，故访问一次主存便可取一条指令或一个数据。随着计算机应用范围的不断扩大，解题精度的不断提高，往往要求指令字长是可变的，数据字长也要求可变。为了适应指令和数据字长的可变性，其长度不由存储字长来确定，而由字节的个数来表示。1个字节（Byte）被定义为8位（bit）二进制代码组成。例如，4字节数据就是32位二进制代码；2字节构成的指令字长是16位二进制代码。当然，此时存储字长、指令字长、数据字长三者可各不相同，但它们必须是字节的整数倍。

##### 1.2.3.1.2 运算器：

运算器最少包括3个寄存器（现代计算机内部往往设有通用寄存器组）和一个算数逻辑单元（ALU）。其中ACC（Accumulator）为累加器 、MQ（Multiplier-Quotient Registry）为乘商寄存器，X为操作数寄存器。这3个寄存器在完成不同运算时，所存放的操作数类别也各不相同。下表列出了寄存器存放不同类别操作数的情况：

![image-20210412204528196](images/计算机组成原理详解/image-20210412204528196.png)

不同机器的运算器结构是不同的。图1.2.3.1所示的运算器可将运算结果从ACC送至存储器中的MDR；而存储器的操作数也可从MDR送至运算器中的ACC、MQ或X。有的机器用MDR取代X寄存器。

下面简要分析一下这种结构的运算器加、减、乘、除四则运算的操作过程：

设：M表示存储器的任一地址号，[M]表示对应M地址号单元中的内容；X表示X寄存器，[X]表示X寄存器中的内容；ACC表示累加器，[ACC]表示累加器中的内容；MQ表示乘商寄存器，[MQ]表示乘商寄存器中的内容。

假设ACC中已有前一时刻的运算结果， 并作为下属运算中的一个操作数，则：

- 加法操作过程为：

  ```javascript
  [M] -> X
  [ACC] + [X] -> ACC
  ```

  即将[ACC]看做被加数，先从主存中取一个存放在M地址号单元内的加数[M]，送至运算器的X寄存器中，然后将被加数[ACC]与加数[X]相加，结果(和)保留在ACC中。

- 减法操作过程为：

  ```javascript
  [M] -> X
  [ACC] - [X] -> ACC
  ```

  即将[ACC]看做被减数，先取出存放在主存M地址号单元中的减数[M]并送入X，然后[ACC]-[X]，结果(差)保留在ACC中。

- 乘法操作过程为：

  ```xml
  [M] -> MQ
  [ACC] -> X
  0 -> ACC
  [X] * [MQ] -> ACC//MQ
  ```

  **[注] //表示两个寄存器串接**

  **[注] 第一步和第二步操作先后可以互换**

  即将[ACC]看做被乘数，先取出存放在主存M号地址单元中的乘数[M]并送入到乘商寄存器MQ，再把被乘数送入到X寄存器，并把ACC清0，然后[X]和[MQ]相乘，结果(积)的高位保留在ACC中，低位保留在MQ中。

- 除法操作过程为：

  ```javascript
  [M] -> X
  [ACC] ÷ [X] -> MQ
  余数R在ACC中
  ```

  即将[ACC]看做被除数，先取出存放在主存M号地址单元内的除数[M]并发送到X寄存器，然后[ACC]除以[X]，结果(商)暂留与MQ，[ACC]为余数R。若需要将商保留在ACC中，只需做一步`[MQ] -> [ACC]`即可。

##### 1.2.3.1.3 控制器：

`控制器是计算机的神经中枢，由它指挥各部件自动、协调的工作`。具体而言，它首先要命令存储器读出一条指令，称为取指过程(也称取指阶段)。接着，它要对这条指令进行分析，指出该指令要完成什么样的操作，并按寻址特征指明操作数的地址，称为分析过程(也称分析阶段、译码阶段)。最后根据操作数所在的地址以及指令的操作码完成某种操作，称为执行过程(也称为执行阶段)。

`控制器由程序计数器(Program Counter，PC)、指令寄存器(Instruction Registry，IR)以及控制单元(CU)组成。`

PC用来存放当前欲执行指令的地址，它与主存的MAR之间有一条直接通路，且具有自动加1的功能，即可自动形成下一条指令的地址。

IR用来存放当前的指令，IR的内容来自主存的MDR。IR的操作码（OP(IR)）送至CU，记作OP(IR)->CU，用来分析指令；其地址码（Ad(IR)）作为操作数的地址送至存储器的MAR，记作Ad(IR)->MAR。CU用来分析当前指令所需完成的操作，并发出各种微操作命令序列，用以控制被控对象。

##### 1.2.3.1.4 I/O：

I/O系统包括各种I/O设备及其相应的接口。每一种I/O设备都由I/O接口与主机联系，它接收CU发出的各种控制命令，并完成相应的操作。例如，键盘(输入设备)由键盘接口电路与主机联系；打印机(输出设备)由打印机接口电路与主机联系。

#### 1.2.3.2 计算机工作的全过程：

下面结合下图进一步深入领会计算机工作的全过程。

![image-20210412224801093](images/计算机组成原理详解/image-20210412224801093.png)

[注]上图中，操作码为6位，操作数为10位

首先，按上图所列的有序指令和数据，通过键盘输入到主存第0号至第12号单元中，并置PC的初始值为0(令程序的首地址为0)。启动机器后，计算机便自动按存储器中所存放的指令顺序有序的逐条完成取指令、分析指令和执行指令，直至执行到程序的最后一条指令为止。

例如，启动机器后，控制器立即将PC的内容发送至主存的MAR（记作PC->MAR），并命令存储器做读操作，此刻主存“0”号单元的内容“0000010000001000”（上图所列程序的第一条指令）便被送入到MDR内。然后由MDR送至控制器的IR（记作MDR->IR），完成一条指令的取指过程。经CU分析（记作OP(IR)->CU），操作码“000001”为取数指令，于是CU又将IR中的地址码“0000001000”送至MAR（记作Ad(IR)->MAR），并命令存储器做读操作，将该地址单元中的操作数x送至MDR，再由MDR送至运算器的ACC（记作MDR->ACC），完成此指令的执行过程。

此刻，也即完成第一条取数指令的全过程，即将操作数x送至运算器ACC中。

与此同时，PC完成自动加1的操作，形成下一条指令的地址“1”号。

同上所述，由PC将第二条指令的地址送至MAR，命令存储器做读操作，将“0001000000001001”送入到MDR，又又MDR送至IR。接着，CU分析操作码“000100”为乘法指令，故CU向存储器发出读命令，取出对应地址为“0000001001”单元中的操作数a，经MDR送至运算器MQ，CU再向运算器发送乘法操作命令，完成ax运算，并把运算结果ax存放在ACC中。同时PC又完成一次(PC)+1->PC，形成下一条指令的地址“2”号。依次类推，逐条取指、分析、执行，直至打印出结果。



## 1.3 计算机硬件的主要技术指标

### 1.3.1 机器字长：

> 机器字长是指CPU一次能处理数据的位数，通常与CPU的寄存器位数有关。

字长越长，数的表示范围越大，精度也越高。机器的字长也会影响机器的运算速度。

### 1.3.2 存储容量：

存储器的容量应该包括主存容量和辅存容量。

主存容量是指主存中存放二进制代码的总位数，即：

```javascript
存储容量 = 存储单元个数 * 存储字长
```

### 1.3.3 运算速度：

现在机器的运算速度普遍采用单位时间执行指令的平均条数来衡量，并用MIPS（Million instruction Per Second，百万条指令每秒）作为计量单位。例如，某机每秒能执行200万条指令，则记作2MIPS。

也可以用CPI（Cycle Per Instruction），即执行一条指令所需的时钟周期（机器主频的倒数），或用FLOPS（Floating Point Operation Per Second，浮点运算次数每秒）来衡量运算速度。



## 1.4 解疑答惑：

### 1.4.1 指令和数据都存于存储器中，计算机如何区分它们？

```javascript
解：
计算机硬件主要通过不同的时间段来区分指令和数据，即：取指周期(或取指微程序)取出的即为指令，执行周期(或相应微程序)取出的即为数据。
另外，也可通过地址来源区分，从PC指出的存储单元取出的是指令，由指令地址码部分提供操作数地址。
```







# 2. 计算机的发展及应用











# 3. 总线

## 3.1 总线的基本概念

### 3.1.1 为什么要使用总线：



### 3.1.2 什么是总线：

> 总线是连接各个部件的信息传输线，是各个部件共享的传输介质。



### 3.1.3 总线上信息的传送：

- 串行

  ![image-20210109101216215](images/计算机组成原理详解/image-20210109101216215.png)

- 并行

  ![image-20210109101259892](images/计算机组成原理详解/image-20210109101259892.png)

### 2.1.4 总线结构的计算机举例：

#### 2.1.4.1 单总线结构框图：

![image-20210109102548858](images/计算机组成原理详解/image-20210109102548858.png)

#### 2.1.4.2 双总线结构：

##### 2.1.4.2.1 面向CPU的双总线结构：

![image-20210109103259365](images/计算机组成原理详解/image-20210109103259365.png)

##### 2.1.4.2.1 以存储器为中心的双总线结构：

![image-20210109104237625](images/计算机组成原理详解/image-20210109104237625.png)



## 2.2 总线的分类

### 2.2.1 片内总线：

> 芯片内部的总线

### 2.2.2 系统总线：

> 计算机各部件之间的信息传输线

系统总线可以分为三类：

- 数据总线：双向，与`机器字长`、`存储字长`有关。

- 地址总线：单向，与存储地址、I/O地址有关。
- 控制总线：有出有入

### 2.2.3 通信总线：

> 用于**计算机系统之间**或**计算机系统与其他系统**（如控制仪表、移动通信等）之间的通信。

传输方式：`串行通信总线` 和 `并行通信总线`

## 2.3 总线特性及性能指标

### 2.3.1 总线特性：

- 机械特性：
  - 尺寸、形状、管脚数、排列顺序...
- 电气特性：
  - 传输方向和有效的电平范围
- 功能特性：
  - 每根传输线的功能（地址信号、控制线号、数据信号、反馈信号）
- 时间特性：
  - 信号的时序关系

### 2.3.2 总线的性能指标：

- 总线宽度：
  - 数据线的根数
- 标准传输率：
  - 每秒传输的最大字节数
- 时钟同步/异步：
  - 同步、不同步
- 总线复用：
  - 地址线和数据线复用
- 信号线数：
  - 地址线、数据线和控制线的总合
- 总线控制方式：
  - 突发、自动、仲裁、逻辑、计数
- 其他指标：
  - 负载能力
  - ...

### 2.3.3 总线标准：

![image-20210109111503615](images/计算机组成原理详解/image-20210109111503615.png)



## 2.4 总线结构

### 2.4.1 单总线结构：

![image-20210109111713529](images/计算机组成原理详解/image-20210109111713529.png)

### 2.4.2 双总线结构：

![image-20210109112610514](images/计算机组成原理详解/image-20210109112610514.png)

### 2.4.3 三总线结构：

- 结构一

  ![image-20210109112900574](images/计算机组成原理详解/image-20210109112900574.png)

- 结构二

  ![image-20210109112957070](images/计算机组成原理详解/image-20210109112957070.png)

### 2.4.4 四总线结构：

![image-20210109113328766](images/计算机组成原理详解/image-20210109113328766.png)

### 2.4.5 总线结构举例：

#### 2.4.5.1 传统微型机总线结构：

![image-20210109113956779](images/计算机组成原理详解/image-20210109113956779.png)

#### 2.4.5.2 VL-BUS局部总线结构：

![image-20210109114058312](images/计算机组成原理详解/image-20210109114058312.png)

#### 2.4.5.3 PCI总线结构：

![image-20210109114140369](images/计算机组成原理详解/image-20210109114140369.png)

#### 2.4.5.4 多层PCI总线结构：

![image-20210109114233451](images/计算机组成原理详解/image-20210109114233451.png)



## 2.5 总线控制

### 2.5.1 总线判优控制：

#### 2.5.1.1 基本概念：

> 主设备(模块)：对总线有控制权（可以提出总线占用请求，以及控制总线上的信息传输）
>
> 从设备(模块)：响应从主设备发来的总线命令（不可以提出总线占用其你去，也不能控制总线上的信息传输）
>
> 注：有些设备既可以是主设备，也可以是从设备

#### 2.5.1.2 判优控制的方法：

判断控制的方法分为两种：

- 集中式：把总线的判优逻辑做在一个部件上
  - 链式查询
  - 计数器定时查询
  - 独立请求方式
- 分布式：判优逻辑分布到各个设备或者各个设备的端口上

### 2.5.2 集中式判优：

#### 2.5.2.1 链式查询：

![image-20210109134602613](images/计算机组成原理详解/image-20210109134602613.png)

#### 2.5.2.2 计数器定时查询：

![image-20210109135935501](images/计算机组成原理详解/image-20210109135935501.png)

#### 2.5.2.3 独立请求方式：

![image-20210109140321720](images/计算机组成原理详解/image-20210109140321720.png)

### 2.5.3 总线通信控制：

> 总线通信控制的目的就是为了解决主设备和从设备之间协调通信的问题

#### 2.5.3.1 总线传输周期：

- 申请分配阶段：主模块申请，总线总裁决定
- 寻址阶段：主模块向从模块给出`地址`和`命令`
- 传输阶段：主模块和从模块交换数据
- 结算阶段：主模块和从模块撤销有关消息

#### 2.5.3.2 总线通信的四种方式：

- 同步通信：由统一的定长定宽的时标控制数据传输
- 异步通信：采用应答方式，没有公共时钟标准
- 半同步通信：同步、异步结合
- 分离式通信：充分挖掘系统总线每个瞬间的潜力



# 3. 存储器

## 3.1 概述

### 3.1.1 存储器可以为哪些类型？

#### 3.1.1.1 按存储介质分类：

- 半导体存储器：TTL、MOS，易失

- 磁表面存储器：磁头、载磁体，非易失

- 磁芯存储器：   硬磁材料、环状元件，非易失

  ![image-20210110160704255](images/计算机组成原理详解/image-20210110160704255.png)

- 光盘存储器：激光、磁光材料，非易失

#### 3.1.1.2 按存取方式分类：

- 存取时间与物理地址无关（随机访问）：

  这种随机访问的存储器都可以称为随机存储器，但是由于历史原因，随机存储器又可以分为两类：

  - 随机存储器：RAM，在程序执行过程中可读可写
  - 只读存储器：ROM，在执行执行过程中只读

  [注]只读存储器虽然是只读的，但也是随机访问的。

- 存储时间与物理地址有关（串行访问）：

  - 顺序存储存储器：磁带
  - 直接存储存储器：磁盘

- 按在计算机中的作用分类：

  - 主存储器：
    - RAM
      - 静态RAM
      - 动态RAM
    - ROM
      - MROM：掩膜ROM
      - PROM：可编程ROM
      - EPROM：电可编程ROM
      - EEPROM：电可擦除可编程ROM
  - Flash Memory：性能介于主存和辅存之间（一般SSD就是基于此的）
  - 辅助存储器：磁盘、磁带、光盘

### 3.1.2 现代存储器的层次结构：

缓存-主存层次和主存-辅存层次：

![image-20210110163852004](images/计算机组成原理详解/image-20210110163852004.png)











## 3.2 主存储器（内存）

### 3.1.1 主存储器的基本组成：

![image-20210110155229226](images/计算机组成原理详解/image-20210110155229226.png)

### 3.1.2 主存和CPU的联系：

![image-20210110155426412](images/计算机组成原理详解/image-20210110155426412.png)















## 3.3 高速缓冲存储器















## 3.4 辅助存储器（外存）



















































